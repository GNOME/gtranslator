#!/bin/sh
##########################################################################
## A pre-parsing script for gtranslator by Fatih Demir [ kabalak@gmx.net ]
##########################################################################
ddir=~/.gtranslator
##########################################################################
case $1 in
--delete | -delete | -d | --d | -D )
for i in $ddir/msgids.dat $ddir/msgstrs.dat $ddir/.sub_success
	do
	[ -f $i ] && rm -f $i
	done
exit 0
;;
*)
;;
esac
##########################################################################
# Change this if you have got problems with the auto-found awk-programm  :
_awk=@AWK@
##########################################################################
file=$1
_strf=$ddir/msgstrs.dat
_idf=$ddir/msgids.dat
##########################################################################
if [ $# -lt 1 ] ; then
	exit 1
fi
if [ ! -f $file ] ; then
	exit 1
fi
##########################################################################
$_awk /msgid/ $file > $_idf
$_awk /msgstr/ $file > $_strf
for i in $_idf $_strf
do
	if [ ! -f $i ] ; then
		exit 1
	fi
done
##########################################################################
sed -e s/msgid\ \"\"// $_idf > $_idf.1
sed -e s/msgstr\ \"\"// $_idf.1 > $_idf
$_awk 'gsub(/msgid "/, "") { print; }' $_idf > $_idf.1
$_awk 'gsub(/"$/, "") { print; } ' $_idf.1 > $_idf 
[ -f $_idf ] && rm -f $_idf.1
$_awk 'gsub(/msgstr "/, "") { print; }' $_strf > $_strf.1
$_awk 'gsub(/"$/, "") { print; } ' $_strf.1 > $_strf
[ -f $_strf ] && rm -f $_strf.1
touch $ddir/.sub_success
exit 0
